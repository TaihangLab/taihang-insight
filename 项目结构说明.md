# 项目结构说明

## API 封装架构

```
taihang-insight/
├── src/
│   ├── api/                          # API 接口模块（新增）
│   │   ├── index.js                  # 统一导出
│   │   ├── channel.js                # 通道管理API
│   │   ├── device.js                 # 设备管理API
│   │   ├── system.js                 # 系统管理API
│   │   ├── region.js                 # 行政区域API
│   │   ├── group.js                  # 业务分组API
│   │   ├── mediaServer.js            # 流媒体服务器API
│   │   ├── stream.js                 # 流管理API
│   │   ├── record.js                 # 录像管理API
│   │   ├── user.js                   # 用户管理API
│   │   └── ptz.js                    # 云台控制API
│   │
│   ├── utils/                        # 工具类（新增）
│   │   └── request.js                # axios统一封装
│   │
│   ├── components/                   # 业务组件
│   │   ├── common/
│   │   │   └── CommonChannelEdit.vue # 已重构示例
│   │   └── ...
│   │
│   ├── config/                       # 配置文件
│   │   └── api.js                    # API配置
│   │
│   └── main.js                       # 入口文件
│
├── API封装使用说明.md                # 详细使用文档
├── API迁移指南.md                    # 迁移操作指南
├── API快速参考.md                    # 快速查询手册
└── 项目结构说明.md                   # 本文件
```

## 核心文件说明

### 1. utils/request.js
- **作用**：统一封装 axios，提供请求/响应拦截
- **特性**：
  - 统一错误处理
  - 统一超时设置
  - 统一请求头配置
  - 401 自动跳转登录

### 2. api/ 目录
- **作用**：按模块组织所有 API 接口
- **规范**：
  - 每个文件负责一个业务模块
  - 使用命名导出
  - 添加 JSDoc 注释
  - 统一参数格式

### 3. api/index.js
- **作用**：统一导出所有 API
- **用途**：支持从一个入口导入所有 API

## API 模块列表

| 模块 | 文件名 | 包含功能 | 状态 |
|------|--------|---------|------|
| 通道管理 | channel.js | 通道增删改查、子通道查询 | ✅ 已完成 |
| 设备管理 | device.js | 设备增删改查、同步、树形结构 | ✅ 已完成 |
| 系统管理 | system.js | 系统配置、服务器信息、日志 | ✅ 已完成 |
| 行政区域 | region.js | 区域增删改查、树形结构 | ✅ 已完成 |
| 业务分组 | group.js | 分组增删改查、树形结构 | ✅ 已完成 |
| 流媒体服务器 | mediaServer.js | 服务器管理、测试连接 | ✅ 已完成 |
| 流管理 | stream.js | 推流、拉流代理管理 | ✅ 已完成 |
| 录像管理 | record.js | 录像查询、下载、云端录像 | ✅ 已完成 |
| 用户管理 | user.js | 登录登出、用户CRUD、密码管理 | ✅ 已完成 |
| 云台控制 | ptz.js | 云台控制、预置位、巡航、扫描 | ✅ 已完成 |

## 使用方式

### 旧方式（不推荐）
```javascript
this.$axios({
  method: 'get',
  url: '/api/xxx',
  params: {}
})
```

### 新方式（推荐）
```javascript
import { getXxx } from '@/api/xxx'

getXxx(params).then(res => {
  // 处理响应
})
```

## 已重构组件

- ✅ `src/components/common/CommonChannelEdit.vue`

## 待重构组件

根据统计，约有 **68 个文件**（234处）使用了 `this.$axios`，需要逐步迁移。

### 优先级分类

**高优先级**（核心业务）：
- 设备管理相关组件
- 通道管理相关组件
- 用户管理相关组件

**中优先级**（常用功能）：
- 录像管理组件
- 流管理组件
- 云台控制组件

**低优先级**（辅助功能）：
- 对话框组件
- 工具组件

## 迁移进度

| 模块 | 总数 | 已完成 | 进度 |
|------|------|--------|------|
| 核心架构 | 2 | 2 | ✅ 100% |
| API 模块 | 10 | 10 | ✅ 100% |
| 业务组件 | 69 | 1 | ⏳ 1.4% |

## 文档说明

### API封装使用说明.md
- 完整的使用文档
- 包含所有 API 模块说明
- 详细的使用示例
- 注意事项和最佳实践

### API迁移指南.md
- 分步骤的迁移教程
- 常见场景对比示例
- 完整的组件迁移示例
- 问题排查指南

### API快速参考.md
- 快速查询手册
- 所有 API 索引
- 常用代码片段
- 命名规范速查表

## 优势总结

✅ **代码更清晰**
- API 调用一目了然
- 减少重复代码
- 提高可读性

✅ **易于维护**
- 接口统一管理
- 修改接口只需改一处
- 便于版本控制

✅ **开发效率**
- 自动补全支持
- 减少错误
- 便于重用

✅ **团队协作**
- 统一编码规范
- 降低学习成本
- 便于代码审查

✅ **质量保证**
- 统一错误处理
- 便于测试
- 易于调试

## 技术栈

- **Vue 2.x** - 前端框架
- **Element UI** - UI 组件库
- **Axios** - HTTP 客户端
- **ES6+** - JavaScript 语法

## 设计模式

- **模块化** - API 按业务模块组织
- **单一职责** - 每个 API 函数只负责一个接口
- **工厂模式** - request.js 封装 axios 实例
- **依赖注入** - 组件导入需要的 API 函数

## 最佳实践

1. **统一导入位置** - 所有 import 语句放在 script 标签顶部
2. **命名规范** - 遵循统一的命名约定
3. **错误处理** - 合理使用全局和局部错误处理
4. **Loading 状态** - 请求时显示加载状态
5. **JSDoc 注释** - 为所有 API 函数添加注释

## 注意事项

⚠️ **不要直接修改 request.js**，除非需要修改全局配置

⚠️ **不要在 API 函数中添加业务逻辑**，保持纯粹性

⚠️ **不要在组件中直接使用 this.$axios**，使用封装的 API

⚠️ **注意参数类型**，GET 用 params，POST 用 data

## 后续计划

1. 逐步迁移其他组件
2. 补充单元测试
3. 添加 TypeScript 类型定义（可选）
4. 完善文档和示例
5. 建立代码审查机制

## 联系方式

如有问题或建议，请联系项目维护人员。

---

**版本**：v1.0  
**更新时间**：2024年  
**维护状态**：✅ 活跃

